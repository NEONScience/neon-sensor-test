---
title: "AMRS Intercomparison Round 3"
author:
  - name: Kevin Styers
  - name: Natchya Durden
  - name: David Durden
  - name: Stefan Metzger
  - name: Hongyan Luo
date: "`r Sys.Date()`"
output:
  distill::distill_article:
    toc: true
    toc_float: true
    toc_depth: 1
---

<!-- Purpose
Background
Recommendation
	Text describing our recommenadtion/decision, general setting proved to work better in our testing
Summary Results
Statistics
Present to SAE group for some final input from rest of the team.
	Monday Morning 8:30AM 2020-10-19
	Practice presenting the results
	See if anything else is needed.
To Report to IS-IPT on 2020-10-21
	Hongyan to give quick background
	Kevin to shortly present final results/recommendation
	
	-->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, error = FALSE, warning = FALSE, message = FALSE, layout = "l-page")
library(distill)
library(ggplot2)
library(ggforce)
library(dplyr)
library(data.table)
library(kableExtra)
library(gridExtra)
library(grid)
```


```{r importData, echo=FALSE, eval=TRUE}
bigData <- base::readRDS("~/eddy/neon-sensor-test/data/2021_AMRS_Round_3/all_amrs_data.RDS")
soniAmrs01_data <- bigData$avg60 %>%
  dplyr::mutate(sensor = "soniAmrs01") %>%
  dplyr::mutate(firmware_version = "01.04.01")
soniAmrs02_data <- bigData$avg60 %>%
  dplyr::mutate(sensor = "soniAmrs02") %>%
  dplyr::mutate(firmware_version = ifelse(test = run == 1, yes = "01.04.01", no = NA)) %>% 
  dplyr::mutate(firmware_version = ifelse(test = run == 2, yes = "01.04.05", no = firmware_version)) %>% 
  dplyr::mutate(firmware_version = ifelse(test = run == 3, yes = "01.05.01", no = firmware_version))  
soniAmrs03_data <- bigData$avg60 %>%
  dplyr::mutate(sensor = "soniAmrs03") %>%
  dplyr::mutate(firmware_version = ifelse(test = run == 1, yes = "01.04.01", no = NA)) %>% 
  dplyr::mutate(firmware_version = ifelse(test = run == 2, yes = "01.05.01", no = firmware_version)) %>% 
  dplyr::mutate(firmware_version = ifelse(test = run == 3, yes = "01.04.05", no = firmware_version))  

# Calculate start end for each run
run_1_duration_dt = soniAmrs01_data %>% 
  dplyr::filter(run == 1) 
run_1_duration = c(as.POSIXct(min(run_1_duration_dt$timeBgn)), as.POSIXct(max(run_1_duration_dt$timeBgn)))
run_1_duration_date = as.Date(run_1_duration, origin = "1970-01-01")
run_2_duration_dt = soniAmrs01_data %>% 
  dplyr::filter(run == 2) 
run_2_duration = c(as.POSIXct(min(run_2_duration_dt$timeBgn)) , as.POSIXct(max(run_2_duration_dt$timeBgn)))
run_2_duration_date = as.Date(run_2_duration, origin = "1970-01-01")
run_3_duration_dt = soniAmrs01_data %>% 
  dplyr::filter(run == 3) 
run_3_duration = c(as.POSIXct(min(run_3_duration_dt$timeBgn)) , as.POSIXct(max(run_3_duration_dt$timeBgn)-1))
run_3_duration_date = as.Date(run_3_duration, origin = "1970-01-01")

soniAmrs_plot_data <- data.table::rbindlist(l = list(soniAmrs01_data, soniAmrs02_data, soniAmrs03_data))
```

# Executive Summary  

An intercomparison analysis was performed to assess the potential differences between AMRS values when configured with different firmware versions.   


*Recommendation:*

> We propose that the two test firmware versions; 01.04.05 and 01.05.01, be approved based upon the results of the analysis. One test sensor appeared to be faulty, but the other test sensor showed very little change between firmware changes and passed the majority of our tests.

```{r, layout = "l-page", echo = FALSE}
ang.plot = bigData$avg60 %>% 
  dplyr::select(timeBgn, sensor, run, angXaxsDeg, angYaxsDeg, angZaxsDeg) %>% 
  reshape2::melt(id.vars = c("timeBgn", "sensor", "run"))

p3.ang_min = 300
p3.ang_max = 360

p3.ang <- ggplot(ang.plot %>% dplyr::filter(variable == "angZaxsDeg")) +
  annotate("rect", xmin = run_1_duration[1], xmax = run_1_duration[2], ymin = p3.ang_min, ymax = p3.ang_max, alpha = 0.65, fill = "green")+
  annotate("rect", xmin = run_2_duration[1], xmax = run_2_duration[2], ymin = p3.ang_min, ymax = p3.ang_max, alpha = 0.65, fill = "grey")+
  annotate("rect", xmin = run_3_duration[1], xmax = run_3_duration[2], ymin = p3.ang_min, ymax = p3.ang_max, alpha = 0.65, fill = "black")+
  geom_hline(yintercept = 337.47, linetype = "dashed") +
  geom_point(alpha = .5, aes(x = timeBgn, y = value, color = sensor)) +
  scale_color_manual(values = c("violet", "firebrick", "blue")) +
  scale_x_datetime(date_breaks = "2 days", date_labels = "%b-%d") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 6), limits = c(p3.ang_min,p3.ang_max))+
  theme(axis.text.x = element_text(angle = 270), legend.position = "top") +
  labs(title = paste0("angZaxsDeg Measurements over the 3 test runs"), 
       caption = "First run (Green) was the controll where all 3 AMRSs had the same firmware\nSecond run (light-gray) soniAmrs02 firmware was 01.04.05 and soniAmrs03 firmware was 01.05.01\nThird run (dark-gray) soniAmrs02 and soniAmrs03 switched firmwares from the previous run",
       y = "Degrees", x = "", color ="")
p3.ang
```

# Purpose  

To access the potential impact of using the two non-tested AMRS firmware versions to see if there are any data quality concerns 

# Background   

Several AMRS firmware versions are currently deployed in the field with various states of Science approval. State as of 2020-02-05:  

* 30 sites with `01.04.01` (approved version)  

* 1   site with `01.07.02` (approved version)   

* 5 sites with `01.05.01` that was not recommended based on the 1st round of test, and should retest it;  

* 9 sites with `01.04.05` that wasn't tested.  

* 2 sites unknown due to earthquakes and sensor refreshes.  

Currently the manufacturer declined to lockdown a specific firmware version to sell to NEON. Given this situation, we must test unapproved firmware versions and verify their ability to integrate into the ECTE system to ensure we are delivering scientific data that are consistently within NEON requirements. As the observatory ages, current AMRS’s firmware versions will go through obsolescence and must be replaced with newer firmware. To alleviate data quality and interoperability concerns across NEON sites we must test the unapproved firmware versions that are currently deployed, as well as any new firmware versions NEON receives from the manufacturer. 

Summary of previous tests: 

1. The 1st round of AMRS comparison test was finished and reported the results in October 2018, approving the firmware version of `01.04.01` and `01.07.02`.   

2. The 2nd round of AMRS comparison test was finished and reported results to IS IPT and sent to stakeholders in October 2020 and updated in RITM0019428. The recommendation was that moving forward the AMRS filter setting should be "general", not "low_mag".  

3. For the 3rd round of AMRS tests, NEON shall test the two most widely deployed and unapproved firmware versions (`01.04.05` and `01.05.01`) against the most widely deployed and approved firmware version (`01.04.01`)   

# Method  

Place a control AMRS sensor's firmware is set to `01.04.01` for the entire duration of the test. Then use two test AMRS where their firmware versions hold the

soniAmrs01 was our control unit, configured with firmware version `01.04.01` for the entire experiment duration.  

* Run 1 Configuration [2021-06-22 - 2021-07-23]   
  * soniAMRS01 - __01.04.01__  
  * soniAMRS02 - __01.04.01__  
  * soniAMRS03 - __01.04.01__  
* Run 2 Configuration [2021-07-24 - 2021-08-07]   
  * soniAMRS01 - __01.04.01__  
  * soniAMRS02 - __01.04.05__  
  * soniAMRS03 - __01.05.01__  
* Run 3 Configuration [2021-08-16 - 2021-08-29]   
  * soniAMRS01 - __01.04.01__  
  * soniAMRS02 - __01.05.01__  
  * soniAMRS03 - __01.04.05__  

<!-- include image here -->
![AMRS Experimental Design](/home/kstyers/eddy/neon-sensor-test/flow/flow.amrs/images/amrs_round03_installation.png)

# Wind Data During Comparison Period  

```{r, layout = "l-page", eval=FALSE}
bigData$soni_mean_avg90$windDir <- eddy4R.base::def.unit.conv(data = bigData$soni_mean_avg90$angZaxsErth, unitFrom = "rad", unitTo = "deg", MethGc = FALSE)
bigData$soni_mean_avg1800$windDir <- eddy4R.base::def.unit.conv(data = bigData$soni_mean_avg1800$angZaxsErth, unitFrom = "rad", unitTo = "deg", MethGc = FALSE)
time <- as.vector(base::as.POSIXlt(bigData$soni_mean_avg1800$timeBgn, format="%Y-%m-%d %H:%M:%OS", tz="UTC"))
wind.speed.data <- bigData$soni_mean_avg1800
wind.speed.data$time <- base::as.POSIXct(wind.speed.data$timeBgn, format="%Y-%m-%d %H:%M:%OS", tz="UTC")
plot.wind.speed <- ggplot(data = wind.speed.data, aes(x = time, y = veloXaxsYaxsErth))+
  # geom_point(size = , alpha = .5) + 
  annotate("rect", xmin = run_1_duration[1], xmax = run_1_duration[2], ymin = 0, ymax = 5, alpha = 0.2, fill = "#00cc00")+
  annotate("rect", xmin = run_2_duration[1], xmax = run_2_duration[2], ymin = 0, ymax = 5, alpha = 0.2, fill = "yellow")+
  geom_point(shape = 1) +
  scale_x_datetime(date_breaks = "1 day") +
  theme(axis.text.x = element_text(angle = 270)) +
  labs(x = "", y = "Wind Speed (m/s)", title = "NEON HQ Tower CSAT3 Wind Speed During AMRS Round 2 Intercomparison") 
plot.wind.dir <- ggplot(data = wind.speed.data, aes(x = time, y = windDir))+
  # geom_point(size = .5, alpha = .5) +
  annotate("rect", xmin = run_1_duration[1], xmax = run_1_duration[2], ymin = 0, ymax = 360, alpha = 0.2, fill = "#00cc00")+
  annotate("rect", xmin = run_2_duration[1], xmax = run_2_duration[2], ymin = 0, ymax = 360, alpha = 0.2, fill = "yellow")+
  geom_point(shape = 1) +
  scale_x_datetime(date_breaks = "1 day") +
  theme(axis.text.x = element_text(angle = 270)) +
  labs(x = "", y = "Wind Direction (degrees)", title = "NEON HQ Tower CSAT3 Wind Direction During AMRS Round 2 Intercomparison") +
  ylim(c(-5,370))
"~/eddy/neon-sensor-test/flow/flow.amrs/images/amrs_round03_installation.png"
print(plot.wind.speed)
print(plot.wind.dir)
```

# Requirements Testing and Statistics  

Key for understanding how each table is set up.  

1. Each day a comparison was run to determine intra-week statistics, providing more granularity in our analysis.  
2. The background color helps track what setting the AMRS was set to:  
  * light-grey <span style="color:silver"><b>example</b></span> cells are set to firmware __01.04.01__.  
  * light-yellow <span style="color:#FCF8CF"><b>example</b></span> cells are set to firmware __01.04.05__.  
  * light-blue <span style="color:#CAF7EC"><b>example</b></span> cells are set to firmware __01.05.01__.   
  
3. The text color indicates if the individual statistic met or failed the requirement. <span style="color:black"><b>Black</b></span> indicates passing, while <span style="color:firebrick"><b>Red</b></span> indicates failing

```{r stats, layout = "l-page"}
stat_files = list.files(path = "~/eddy/neon-sensor-test/data/2021_AMRS_Round_3/stats/", full.names = TRUE)
stats.data <- data.table::data.table()
# Note... There was no data for 03-28 and 03-29
for(i in stat_files){

  # Read in File
  ingest.data <- base::readRDS(i)
  # Merge it with master file
  stats.data <- data.table::rbindlist(l = list(stats.data, ingest.data))

}
stats.data <- stats.data %>%
  dplyr::mutate(value = abs(as.numeric(value)))
# options(scipen=999)
```

## Velocities  

### Precision  

To ensure the detectability of < 1 W m-2 least resolvable change in the eddy-covariance sensible heat flux measurements, the combination of AMRS and 3-D sonic anemometer shall enable determining the 3-D wind vector with respect to the earth coordinate system to within ± 0.05 m s-1 precision.  

Both settings <span style="color:#00cc00"><b>PASSED</b></span>

```{r, layout = "l-page"}
acc_axsDiffFilt.prcs_requirement = 0.05
acc_axsDiffFilt.prcs <- stats.data %>%
  dplyr::filter(stringr::str_detect(string = measurement, pattern = "axsDiffFilt") == TRUE) %>%
  dplyr::filter(stat %in% c("prcs"))%>%
  dplyr::mutate(test_date = as.Date(test.date, origin = "1970-01-01")) %>% dplyr::select(-test.date) %>% 
  dplyr::mutate(value = round(value, 6)) %>%
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_1_duration_date[1], to = run_1_duration_date[2], by = "1 day"), yes = "01.04.01", no = NA)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_1_duration_date[1], to = run_1_duration_date[2], by = "1 day"), yes = "01.04.01", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_2_duration_date[1], to = run_2_duration_date[2], by = "1 day"), yes = "01.04.05", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_3_duration_date[1], to = run_3_duration_date[2], by = "1 day"), yes = "01.05.01", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_2_duration_date[1], to = run_2_duration_date[2], by = "1 day"), yes = "01.05.01", no = setting)) %>%
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_3_duration_date[1], to = run_3_duration_date[2], by = "1 day"), yes = "01.04.05", no = setting)) %>% 
  dplyr::filter(is.na(setting) == FALSE) %>%
  dplyr::filter(is.na(value) == FALSE) %>%
  dplyr::mutate(value = kableExtra::cell_spec(value, "html", color = ifelse(abs(value) <= acc_axsDiffFilt.prcs_requirement, "black","red"), background = ifelse(setting == "01.04.05", "#FCF8CF", no = ifelse(setting == "01.05.01", yes = "#CAF7EC", no = ifelse(setting == "01.04.01", yes ="silver", no = "white"))), bold = TRUE)) %>% 
  reshape2::dcast(sensor + measurement + stat ~ test_date)   

DT::datatable(acc_axsDiffFilt.prcs, escape = FALSE, extensions = c('FixedColumns'), options = list(scrollX = TRUE, fixedColumns = list(leftColumns = 4))) %>% 
  DT::formatStyle(columns = c("sensor", "measurement", "stat"), backgroundColor = 'silver') 
```

### Accuracy  

To ensure the detectability of < 5 W m-2 advective divergence in the eddy-covariance sensible heat flux measurements, the combination of AMRS and 3-D sonic anemometer shall enable determining the 3-D wind vector with respect to the earth coordinate system to within ± 0.10 m s-1 accuracy.  

Both settings <span style="color:#00cc00"><b>PASSED</b></span>  

```{r, layout = "l-page"}
acc_axsDiffFilt.diffMean_requirement = 0.10
acc_axsDiffFilt.diffMean <- stats.data %>%
  dplyr::filter(stringr::str_detect(string = measurement, pattern = "axsDiffFilt") == TRUE) %>%
  dplyr::filter(stat %in% c("diffMean"))%>%
  dplyr::mutate(value = round(value, 10)) %>%
  dplyr::mutate(test_date = as.Date(test.date, origin = "1970-01-01")) %>% dplyr::select(-test.date) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_1_duration_date[1], to = run_1_duration_date[2], by = "1 day"), yes = "01.04.01", no = NA)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_1_duration_date[1], to = run_1_duration_date[2], by = "1 day"), yes = "01.04.01", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_2_duration_date[1], to = run_2_duration_date[2], by = "1 day"), yes = "01.04.05", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_3_duration_date[1], to = run_3_duration_date[2], by = "1 day"), yes = "01.05.01", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_2_duration_date[1], to = run_2_duration_date[2], by = "1 day"), yes = "01.05.01", no = setting)) %>%
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_3_duration_date[1], to = run_3_duration_date[2], by = "1 day"), yes = "01.04.05", no = setting)) %>% 
  dplyr::filter(is.na(setting) == FALSE) %>%
  dplyr::filter(is.na(value) == FALSE) %>%
  dplyr::mutate(value = kableExtra::cell_spec(value, "html", color = ifelse(abs(value) <= acc_axsDiffFilt.diffMean_requirement, "black","red"), background = ifelse(setting == "01.04.05", "#FCF8CF", no = ifelse(setting == "01.05.01", yes = "#CAF7EC", no = ifelse(setting == "01.04.01", yes ="silver", no = "white"))), bold = TRUE)) %>% 
  reshape2::dcast(sensor + measurement + stat ~ test_date)  

DT::datatable(acc_axsDiffFilt.diffMean, escape = FALSE, extensions = c('FixedColumns'), options = list(scrollX = TRUE, fixedColumns = list(leftColumns = 4))) %>% 
  DT::formatStyle(columns = c("sensor", "measurement", "stat"), backgroundColor = 'silver') 
```


## Angular Rate  

### Precison  

To enable determining the 3-D wind vector with respect to the earth coordinate system, the AMRS shall be capable of measuring angular rates around either of 3 axes with a precision of ≤ 2.0 deg s-1.  

Both settings <span style="color:#00cc00"><b>PASSED</b></span>  

```{r, layout = "l-page"}
avel_axsDeg.prcs_requirement = 2.0
avel_axsDeg.prcs <- stats.data %>%
  dplyr::filter(stringr::str_detect(string = measurement, pattern = "avel") == TRUE) %>%
  dplyr::filter(stat %in% c("prcs"))%>%
  dplyr::mutate(value = round(value, 7)) %>%
  dplyr::mutate(test_date = as.Date(test.date, origin = "1970-01-01")) %>% dplyr::select(-test.date) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_1_duration_date[1], to = run_1_duration_date[2], by = "1 day"), yes = "01.04.01", no = NA)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_1_duration_date[1], to = run_1_duration_date[2], by = "1 day"), yes = "01.04.01", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_2_duration_date[1], to = run_2_duration_date[2], by = "1 day"), yes = "01.04.05", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_3_duration_date[1], to = run_3_duration_date[2], by = "1 day"), yes = "01.05.01", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_2_duration_date[1], to = run_2_duration_date[2], by = "1 day"), yes = "01.05.01", no = setting)) %>%
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_3_duration_date[1], to = run_3_duration_date[2], by = "1 day"), yes = "01.04.05", no = setting)) %>% 
  dplyr::filter(is.na(setting) == FALSE) %>%
  dplyr::filter(is.na(value) == FALSE) %>%
  dplyr::mutate(value = kableExtra::cell_spec(value, "html", color = ifelse(abs(value) <= avel_axsDeg.prcs_requirement, "black","red"), background = ifelse(setting == "01.04.05", "#FCF8CF", no = ifelse(setting == "01.05.01", yes = "#CAF7EC", no = ifelse(setting == "01.04.01", yes ="silver", no = "white"))), bold = TRUE)) %>% 
  # dplyr::filter(test_date >= run_3_duration[1]) %>% 
  reshape2::dcast(sensor + measurement + stat ~ test_date)  

DT::datatable(avel_axsDeg.prcs, escape = FALSE, extensions = c('FixedColumns'), options = list(scrollX = TRUE, fixedColumns = list(leftColumns = 4))) %>% 
  DT::formatStyle(columns = c("sensor", "measurement", "stat"), backgroundColor = 'silver') 
```

### Resolution  

To enable determining the 3-D wind vector with respect to the earth coordinate system, the AMRS shall be capable of measuring angular rates around either of 3 axes with a resolution of  ≤ 0.2 deg s-1.  

Both settings <span style="color:#00cc00"><b>PASSED</b></span>

```{r, layout = "l-page"}
avel_axsDeg.reso_requirement = 0.2
avel_axsDeg.reso <- stats.data %>%
  dplyr::filter(stringr::str_detect(string = measurement, pattern = "avel") == TRUE) %>%
  dplyr::filter(stat %in% c("reso")) %>%
  dplyr::mutate(value = round(value, 7)) %>%
  dplyr::mutate(test_date = as.Date(test.date, origin = "1970-01-01")) %>% dplyr::select(-test.date) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_1_duration_date[1], to = run_1_duration_date[2], by = "1 day"), yes = "01.04.01", no = NA)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_1_duration_date[1], to = run_1_duration_date[2], by = "1 day"), yes = "01.04.01", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_2_duration_date[1], to = run_2_duration_date[2], by = "1 day"), yes = "01.04.05", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_3_duration_date[1], to = run_3_duration_date[2], by = "1 day"), yes = "01.05.01", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_2_duration_date[1], to = run_2_duration_date[2], by = "1 day"), yes = "01.05.01", no = setting)) %>%
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_3_duration_date[1], to = run_3_duration_date[2], by = "1 day"), yes = "01.04.05", no = setting)) %>% 
  dplyr::filter(is.na(setting) == FALSE) %>%
  dplyr::filter(is.na(value) == FALSE) %>%
  dplyr::mutate(value = kableExtra::cell_spec(value, "html", color = ifelse(abs(value) <= avel_axsDeg.reso_requirement, "black","red"), background = ifelse(setting == "01.04.05", "#FCF8CF", no = ifelse(setting == "01.05.01", yes = "#CAF7EC", no = ifelse(setting == "01.04.01", yes ="silver", no = "white"))), bold = TRUE)) %>% 
  reshape2::dcast(sensor + measurement + stat ~ test_date)

DT::datatable(avel_axsDeg.reso, escape = FALSE, extensions = c('FixedColumns'), options = list(scrollX = TRUE, fixedColumns = list(leftColumns = 4))) %>% 
  DT::formatStyle(columns = c("sensor", "measurement", "stat"), backgroundColor = 'silver') 
```


### Accuracy

To enable determining the 3-D wind vector with respect to the earth coordinate system, the AMRS shall be capable of measuring angular rates around either of 3 axes with an accuracy of ≤ 4.0 deg s-1.  

Both settings <span style="color:#00cc00"><b>PASSED</b></span>  

```{r, layout = "l-page"}
avel_axsDeg.diffMean_requirement = 4.00
avel_axsDeg.diffMean <- stats.data %>%
  dplyr::filter(stringr::str_detect(string = measurement, pattern = "avel") == TRUE) %>%
  dplyr::filter(stat %in% c("diffMean"))%>%
  dplyr::mutate(value = round(value, 7)) %>%
  dplyr::mutate(test_date = as.Date(test.date, origin = "1970-01-01")) %>% dplyr::select(-test.date) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_1_duration_date[1], to = run_1_duration_date[2], by = "1 day"), yes = "01.04.01", no = NA)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_1_duration_date[1], to = run_1_duration_date[2], by = "1 day"), yes = "01.04.01", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_2_duration_date[1], to = run_2_duration_date[2], by = "1 day"), yes = "01.04.05", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_3_duration_date[1], to = run_3_duration_date[2], by = "1 day"), yes = "01.05.01", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_2_duration_date[1], to = run_2_duration_date[2], by = "1 day"), yes = "01.05.01", no = setting)) %>%
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_3_duration_date[1], to = run_3_duration_date[2], by = "1 day"), yes = "01.04.05", no = setting)) %>% 
  dplyr::filter(is.na(setting) == FALSE) %>%
  dplyr::filter(is.na(value) == FALSE) %>%
  dplyr::mutate(value = kableExtra::cell_spec(value, "html", color = ifelse(abs(value) <= avel_axsDeg.diffMean_requirement, "black","red"), background = ifelse(setting == "01.04.05", "#FCF8CF", no = ifelse(setting == "01.05.01", yes = "#CAF7EC", no = ifelse(setting == "01.04.01", yes ="silver", no = "white"))), bold = TRUE)) %>% 
  reshape2::dcast(sensor + measurement + stat ~ test_date)

DT::datatable(avel_axsDeg.diffMean, escape = FALSE, extensions = c('FixedColumns'), options = list(scrollX = TRUE, fixedColumns = list(leftColumns = 4))) %>% 
  DT::formatStyle(columns = c("sensor", "measurement", "stat"), backgroundColor = 'silver') 
```


## Angles  

### Accuracy of Z-azimuth  

To enable determining the 3-D wind vector with respect to the earth coordinate system, the AMRS shall be capable of measuring azimuth (around z-axis) with an accuracy of ≤ 4 deg, including any internal alignment offsets.  

soniAMRS02 entirely <span style="color:#b22222"><b>FAILED</b></span> regardless of what setting it was on.  

soniAmrs03 entirely <span style="color:#00cc00"><b>PASSED</b></span> regardless of what setting it was on.  

```{r, layout = "l-page"}
ang_axsDeg.diffMean_requirement = 4.00
ang_axsDeg.diffMean <- stats.data %>%
  dplyr::filter(stringr::str_detect(string = measurement, pattern = "angZ") == TRUE) %>%
  dplyr::filter(stat %in% c("diffMean"))%>%
  dplyr::mutate(value = round(value, 5)) %>%
  dplyr::mutate(test_date = as.Date(test.date, origin = "1970-01-01")) %>% dplyr::select(-test.date) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_1_duration_date[1], to = run_1_duration_date[2], by = "1 day"), yes = "01.04.01", no = NA)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_1_duration_date[1], to = run_1_duration_date[2], by = "1 day"), yes = "01.04.01", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_2_duration_date[1], to = run_2_duration_date[2], by = "1 day"), yes = "01.04.05", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_3_duration_date[1], to = run_3_duration_date[2], by = "1 day"), yes = "01.05.01", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_2_duration_date[1], to = run_2_duration_date[2], by = "1 day"), yes = "01.05.01", no = setting)) %>%
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_3_duration_date[1], to = run_3_duration_date[2], by = "1 day"), yes = "01.04.05", no = setting)) %>% 
  dplyr::filter(is.na(setting) == FALSE) %>%
  dplyr::filter(is.na(value) == FALSE) 

ang_axsDeg.diffMean.reshape = ang_axsDeg.diffMean %>%
  dplyr::mutate(value = kableExtra::cell_spec(value, "html", color = ifelse(abs(value) <= ang_axsDeg.diffMean_requirement, "black","red"), background = ifelse(setting == "01.04.05", "#FCF8CF", no = ifelse(setting == "01.05.01", yes = "#CAF7EC", no = ifelse(setting == "01.04.01", yes ="silver", no = "white"))), bold = TRUE)) %>% 
  reshape2::dcast(sensor + measurement + stat ~ test_date)
DT::datatable(ang_axsDeg.diffMean.reshape, escape = FALSE, options = list(scrollX = TRUE)) %>% 
  DT::formatStyle(columns = c("sensor", "measurement", "stat"), backgroundColor = 'gray')


ggplot(ang_axsDeg.diffMean, aes(x = test_date, y = value, color = sensor))+
  annotate("rect", xmin = min(ang_axsDeg.diffMean$test_date), xmax = max(ang_axsDeg.diffMean$test_date), ymin = 0, ymax = 4.0, alpha = 0.65, fill = "green")+
  scale_x_date(breaks = scales::pretty_breaks(4)) +
  geom_vline(xintercept = as.Date(run_1_duration[1], origin = "1970-01-01"),alpha = .5, linetype = "dashed", color = "black") +
  geom_vline(xintercept = as.Date(run_1_duration[2], origin = "1970-01-01"),alpha = .5, linetype = "dashed", color = "black") +
  geom_vline(xintercept = as.Date(run_2_duration[2], origin = "1970-01-01"),alpha = .5, linetype = "dashed", color = "black") +
  geom_vline(xintercept = as.Date(run_3_duration[2], origin = "1970-01-01"),alpha = .5, linetype = "dashed", color = "black") +
  geom_point()+
  scale_y_continuous(limits = c(0, max(ang_axsDeg.diffMean$value, na.rm = TRUE)), breaks = scales::pretty_breaks(n = 10)) +
  labs(x ="", y = "diffMean", title = "Comparison of angZaxsDeg measurements to the reference soniAMRS01", subtitle = "Requirement is that diffMean be below 4.0")+
  facet_wrap(~measurement, scales = "free_y") +
  theme(legend.position = "top")
```

### Precision  

To enable determining the 3-D wind vector with respect to the earth coordinate system, the AMRS shall be capable of measuring azimuth (around z-axis), pitch (around y-axis) and roll (around x-axis) with a precision of ≤ 0.1 deg.

Both sensors struggled with this comparison of precision. 

1. angXaxsDeg: 
* soniAmrs02 mostly passed during all the 3 runs (`01.04.01`, `01.04.05`, `01.05.01`)  
* soniAmrs03 failed entirely, but by a very close margin, on average it was `0.07` above the `0.1` theshold  

2. angYaxsDeg:  
* soniAmrs02 mostly failed, but by a very close margin, on average it was `0.002` above the `0.1` threshold  
* soniAmrs03 entirely failed, but by a close margin, on average is was `0.03` above the `0.1` threshold

3. angZaxsDeg:  
* soniAmrs02 entirely failed, by a margin of `1.06` above the `0.1` threshold  
* soniAmrs03 entirely failed, by a margin of `0.39` above the `0.1` threshold  

```{r, layout = "l-page"}
ang_axsDeg.prcs_requirement = 0.1
ang_axsDeg.prcs <- stats.data %>%
  dplyr::filter(stringr::str_detect(string = measurement, pattern = "ang") == TRUE) %>%
  dplyr::filter(stat %in% c("prcs"))%>%
  dplyr::mutate(value = round(value, 5)) %>%
  dplyr::mutate(test_date = as.Date(test.date, origin = "1970-01-01")) %>% dplyr::select(-test.date) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_1_duration_date[1], to = run_1_duration_date[2], by = "1 day"), yes = "01.04.01", no = NA)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_1_duration_date[1], to = run_1_duration_date[2], by = "1 day"), yes = "01.04.01", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_2_duration_date[1], to = run_2_duration_date[2], by = "1 day"), yes = "01.04.05", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_3_duration_date[1], to = run_3_duration_date[2], by = "1 day"), yes = "01.05.01", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_2_duration_date[1], to = run_2_duration_date[2], by = "1 day"), yes = "01.05.01", no = setting)) %>%
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_3_duration_date[1], to = run_3_duration_date[2], by = "1 day"), yes = "01.04.05", no = setting)) %>% 
  dplyr::filter(is.na(setting) == FALSE) %>%
  dplyr::filter(is.na(value) == FALSE) 

ang_axsDeg.prcs_table = ang_axsDeg.prcs %>%
  dplyr::mutate(value = kableExtra::cell_spec(value, "html", color = ifelse(abs(value) <= ang_axsDeg.prcs_requirement, "black","red"), background = ifelse(setting == "01.04.05", "#FCF8CF", no = ifelse(setting == "01.05.01", yes = "#CAF7EC", no = ifelse(setting == "01.04.01", yes ="silver", no = "white"))), bold = TRUE)) %>% 
  reshape2::dcast(sensor + measurement + stat ~ test_date)
DT::datatable(ang_axsDeg.prcs_table, escape = FALSE, options = list(scrollX = TRUE)) %>% 
  DT::formatStyle(columns = c("sensor", "measurement", "stat"), backgroundColor = 'gray')

## STATS 
# ang_axsDeg.prcs %>% 
#   dplyr::filter(sensor == "soniAmrs02" & stat == "prcs" & measurement == "angZaxsDeg") %>% 
#   summarize(
#     mean(value)
#   )


ggplot(ang_axsDeg.prcs, aes(x = test_date, y = value, color = sensor))+
  annotate("rect", xmin = min(ang_axsDeg.prcs$test_date), xmax = max(ang_axsDeg.prcs$test_date), ymin = 0, ymax = .1, alpha = 0.65, fill = "green")+
  scale_x_date(breaks = scales::pretty_breaks(4)) +
  geom_vline(xintercept = as.Date(run_1_duration[1], origin = "1970-01-01"),alpha = .5, linetype = "dashed", color = "black") +
  geom_vline(xintercept = as.Date(run_1_duration[2], origin = "1970-01-01"),alpha = .5, linetype = "dashed", color = "black") +
  geom_vline(xintercept = as.Date(run_2_duration[2], origin = "1970-01-01"),alpha = .5, linetype = "dashed", color = "black") +
  geom_vline(xintercept = as.Date(run_3_duration[2], origin = "1970-01-01"),alpha = .5, linetype = "dashed", color = "black") +
  geom_point()+
  geom_hline(yintercept = .1) +
  labs(x ="", y = "prcs", title = "Comparison of ang axs measurements to the reference soniAMRS01", subtitle = "Requirement is that prcs be below 0.1")+
  facet_wrap(~measurement, scales = "free_y") +
  theme(legend.position = "top")
```

### Resolution  

To enable determining the 3-D wind vector with respect to the earth coordinate system, the AMRS shall be capable of measuring azimuth (around z-axis), pitch (around y-axis) and roll (around x-axis) with a resolution of  ≤ 0.05 deg.  

Both settings <span style="color:#00cc00"><b>PASSED</b></span>  

```{r, layout = "l-page"}
ang_axsDeg.reso_requirement = 0.05
ang_axsDeg.reso <- stats.data %>%
  dplyr::filter(stringr::str_detect(string = measurement, pattern = "ang") == TRUE) %>%
  dplyr::filter(stat %in% c("reso"))%>%
  # dplyr::mutate(value = round(value, 7)) %>%
  dplyr::mutate(test_date = as.Date(test.date, origin = "1970-01-01")) %>% dplyr::select(-test.date) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_1_duration_date[1], to = run_1_duration_date[2], by = "1 day"), yes = "01.04.01", no = NA)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_1_duration_date[1], to = run_1_duration_date[2], by = "1 day"), yes = "01.04.01", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_2_duration_date[1], to = run_2_duration_date[2], by = "1 day"), yes = "01.04.05", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_3_duration_date[1], to = run_3_duration_date[2], by = "1 day"), yes = "01.05.01", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_2_duration_date[1], to = run_2_duration_date[2], by = "1 day"), yes = "01.05.01", no = setting)) %>%
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_3_duration_date[1], to = run_3_duration_date[2], by = "1 day"), yes = "01.04.05", no = setting)) %>% 
  dplyr::filter(is.na(setting) == FALSE) %>%
  dplyr::filter(is.na(value) == FALSE) %>%
  dplyr::mutate(value = kableExtra::cell_spec(value, "html", color = ifelse(abs(value) <= ang_axsDeg.reso_requirement, "black","red"), background = ifelse(setting == "01.04.05", "#FCF8CF", no = ifelse(setting == "01.05.01", yes = "#CAF7EC", no = ifelse(setting == "01.04.01", yes ="silver", no = "white"))), bold = TRUE)) %>% 
  reshape2::dcast(sensor + measurement + stat ~ test_date)

DT::datatable(ang_axsDeg.reso, escape = FALSE, extensions = c('FixedColumns'), options = list(scrollX = TRUE, fixedColumns = list(leftColumns = 4))) %>% 
  DT::formatStyle(columns = c("sensor", "measurement", "stat"), backgroundColor = 'silver') 
```

### Accuracy

To enable determining the 3-D wind vector with respect to the earth coordinate system, the AMRS shall be capable of measuring pitch (around y-axis) and roll (around x-axis) with an accuracy of ≤ 1 deg, including any internal alignment offsets.  

Both settings <span style="color:#00cc00"><b>PASSED</b></span>  

```{r, layout = "l-page"}
ang_axsDeg.diffMean_requirement = 1.0
ang_axsDeg.diffMean <- stats.data %>%
  dplyr::filter(measurement %in% c("angYaxsDeg", "angXaxsDeg")) %>%
  dplyr::filter(stat %in% c("diffMean"))%>%
  dplyr::mutate(value = round(value, 5)) %>%
  dplyr::mutate(test_date = as.Date(test.date, origin = "1970-01-01")) %>% dplyr::select(-test.date) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_1_duration_date[1], to = run_1_duration_date[2], by = "1 day"), yes = "01.04.01", no = NA)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_1_duration_date[1], to = run_1_duration_date[2], by = "1 day"), yes = "01.04.01", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_2_duration_date[1], to = run_2_duration_date[2], by = "1 day"), yes = "01.04.05", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs02" & test_date %in% seq.Date(from = run_3_duration_date[1], to = run_3_duration_date[2], by = "1 day"), yes = "01.05.01", no = setting)) %>% 
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_2_duration_date[1], to = run_2_duration_date[2], by = "1 day"), yes = "01.05.01", no = setting)) %>%
  dplyr::mutate(setting = ifelse(test = sensor == "soniAmrs03" & test_date %in% seq.Date(from = run_3_duration_date[1], to = run_3_duration_date[2], by = "1 day"), yes = "01.04.05", no = setting)) %>% 
  dplyr::filter(is.na(setting) == FALSE) %>%
  dplyr::filter(is.na(value) == FALSE) %>%
  dplyr::mutate(value = kableExtra::cell_spec(value, "html", color = ifelse(abs(value) <= ang_axsDeg.diffMean_requirement, "black","red"), background = ifelse(setting == "01.04.05", "#FCF8CF", no = ifelse(setting == "01.05.01", yes = "#CAF7EC", no = ifelse(setting == "01.04.01", yes ="silver", no = "white"))), bold = TRUE)) %>% 
  reshape2::dcast(sensor + measurement + stat ~ test_date)

DT::datatable(ang_axsDeg.diffMean, escape = FALSE, extensions = c('FixedColumns'), options = list(scrollX = TRUE, fixedColumns = list(leftColumns = 4))) %>% 
  DT::formatStyle(columns = c("sensor", "measurement", "stat"), backgroundColor = 'silver') 
```


## Supplemental Plots  

### accXaxs + accYaxs + accZaxs  

```{r, layout = "l-page", eval = FALSE}
#Ploting 1:1 comparison each soniAmrs
require(stats)
# Westerly wind will give us better data
soniAmrs01_data <- soniAmrs_plot_data %>%
  dplyr::filter(sensor == "soniAmrs01")
soniAmrs02_data <- soniAmrs_plot_data %>%
  dplyr::filter(sensor == "soniAmrs02")
soniAmrs03_data <- soniAmrs_plot_data %>%
  dplyr::filter(sensor == "soniAmrs03")
test.melt <- soniAmrs_plot_data %>%
  reshape2::melt(id.vars = c("timeBgn", "sensor","run", "firmware_version")) %>%
  tidyr::unite(col = "measurement", c("sensor","variable","firmware_version")) %>%
  reshape2::dcast(timeBgn + run ~ measurement, value.var = "value", fun.aggregate = mean)

p1 <- ggplot(data = test.melt %>% dplyr::filter(run == 1) %>% dplyr::filter(soniAmrs01_accXaxs_01.04.01 > -1000 & soniAmrs02_accXaxs_01.04.01 > -1000), 
             aes(x = soniAmrs01_accXaxs_01.04.01, y = soniAmrs02_accXaxs_01.04.01)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red") +
  labs(title = "soniAmrs 1 and 2", subtitle = "\taccXaxs", x = "soniAmrs01\naccXaxs 01.04.01", y = "soniAmrs02\naccXaxs 01.04.01")  +
  facet_wrap(~run)

p2 <- ggplot(data = test.melt %>% dplyr::filter(run == 1) %>% dplyr::filter(soniAmrs01_accXaxs_01.04.01 > -1000 & soniAmrs03_accXaxs_01.04.01 > -1000), 
             aes(x = soniAmrs01_accXaxs_01.04.01, y = soniAmrs03_accXaxs_01.04.01)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red") +
  labs(title = "soniAmrs 1 and 3", subtitle = "\taccXaxs", x = "soniAmrs01\naccXaxs 01.04.01", y = "soniAmrs03\naccXaxs 01.04.01") +
  facet_wrap(~run)

p3 <- ggplot(data = test.melt %>% dplyr::filter(run == 1) %>% dplyr::filter(soniAmrs02_accXaxs_01.04.01 > -1000 & soniAmrs03_accXaxs_01.04.01 > -1000),
             aes(x = soniAmrs02_accXaxs_01.04.01, y = soniAmrs03_accXaxs_01.04.01)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red") +
  labs(title = "soniAmrs 2 and 3", subtitle = "\taccXaxs", x = "soniAmrs02\naccXaxs 01.04.01", y = "soniAmrs03\naccXaxs 01.04.01") +
  facet_wrap(~run)

gridExtra::grid.arrange(p1, p2, p3, nrow = 1)


data.plot <- data.table()
data.plot$soniAmrs01_mean_avg60.accXaxs = soniAmrs01_data$accXaxs
data.plot$soniAmrs02_mean_avg60.accXaxs = soniAmrs02_data$accXaxs
data.plot$soniAmrs03_mean_avg60.accXaxs = soniAmrs03_data$accXaxs
soniAmrs01_data$accy
p1 <- ggplot(data = data.plot, aes(x = soniAmrs01_mean_avg60.accXaxs, y = soniAmrs02_mean_avg60.accXaxs)) +
  geom_point() +
  geom_smooth(method = "lm", color = "red") +
  labs(title = "soniAmrs 1 and 2", subtitle = "\taccXaxs", x = "soniAmrs01 accXaxs", y = "soniAmrs02 accXaxs") +
  facet_wrap(~firmware_version)
data.plot$soniAmrs01_mean_avg60.accYaxs = bigData$soniAmrs01_mean_avg60$accYaxs
data.plot$soniAmrs02_mean_avg60.accYaxs = bigData$soniAmrs02_mean_avg60$accYaxs
data.plot$soniAmrs03_mean_avg60.accYaxs = bigData$soniAmrs03_mean_avg60$accYaxs
data.plot$soniAmrs01_mean_avg60.accZaxs = bigData$soniAmrs01_mean_avg60$accZaxs
data.plot$soniAmrs02_mean_avg60.accZaxs = bigData$soniAmrs02_mean_avg60$accZaxs
data.plot$soniAmrs03_mean_avg60.accZaxs = bigData$soniAmrs03_mean_avg60$accZaxs
data.plot <- data.plot %>%
  dplyr::filter(is.na(soniAmrs01_mean_avg60.accXaxs) == FALSE) %>%
  dplyr::filter(is.na(soniAmrs02_mean_avg60.accXaxs) == FALSE) 
p1 <- ggplot(data = data.plot, aes(x = soniAmrs01_mean_avg60.accXaxs, y = soniAmrs02_mean_avg60.accXaxs)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red") +
  labs(title = "soniAmrs 1 and 2", subtitle = "\taccXaxs", x = "soniAmrs01 accXaxs", y = "soniAmrs02 accXaxs") +
  facet_wrap(~firmware_version)
p2 <- ggplot(data = data.plot, aes(x = soniAmrs01_mean_avg60.accXaxs, y = soniAmrs03_mean_avg60.accXaxs)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red")+
  labs(title = "soniAmrs 1 and 3", subtitle = "\taccXaxs",x = "soniAmrs01 accXaxs", y = "soniAmrs03 accXaxs")
p3 <- ggplot(data = data.plot, aes(x = soniAmrs02_mean_avg60.accXaxs, y = soniAmrs03_mean_avg60.accXaxs)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red")+
  labs(title = "soniAmrs 2 and 3", subtitle = "\taccXaxs",x = "soniAmrs02 accXaxs", y = "soniAmrs03 accXaxs")
  
gridExtra::grid.arrange(p1, p2, p3, nrow = 1)
p4 <- ggplot(data = data.plot, aes(x = soniAmrs01_mean_avg60.accYaxs, y = soniAmrs02_mean_avg60.accYaxs)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red") +
  labs(title = "soniAmrs 1 and 2", subtitle = "\taccYaxs", x = "soniAmrs01 accYaxs", y = "soniAmrs02 accYaxs")
p5 <- ggplot(data = data.plot, aes(x = soniAmrs01_mean_avg60.accYaxs, y = soniAmrs03_mean_avg60.accYaxs)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red")+
  labs(title = "soniAmrs 1 and 3", subtitle = "\taccYaxs",x = "soniAmrs01 accYaxs", y = "soniAmrs03 accYaxs")
p6 <- ggplot(data = data.plot, aes(x = soniAmrs02_mean_avg60.accYaxs, y = soniAmrs03_mean_avg60.accYaxs)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red")+
  labs(title = "soniAmrs 2 and 3", subtitle = "\taccYaxs",x = "soniAmrs02 accYaxs", y = "soniAmrs03 accYaxs")
  
gridExtra::grid.arrange(p4, p5, p6, nrow = 1)
p7 <- ggplot(data = data.plot, aes(x = soniAmrs01_mean_avg60.accZaxs, y = soniAmrs02_mean_avg60.accZaxs)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red") +
  labs(title = "soniAmrs 1 and 2", subtitle = "\taccZaxs", x = "soniAmrs01 accZaxs", y = "soniAmrs02 accZaxs")
p8 <- ggplot(data = data.plot, aes(x = soniAmrs01_mean_avg60.accZaxs, y = soniAmrs03_mean_avg60.accZaxs)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red")+
  labs(title = "soniAmrs 1 and 3", subtitle = "\taccZaxs",x = "soniAmrs01 accZaxs", y = "soniAmrs03 accZaxs")
p9 <- ggplot(data = data.plot, aes(x = soniAmrs02_mean_avg60.accZaxs, y = soniAmrs03_mean_avg60.accZaxs)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red")+
  labs(title = "soniAmrs 2 and 3", subtitle = "\taccZaxs",x = "soniAmrs02 accZaxs", y = "soniAmrs03 accZaxs")
  
gridExtra::grid.arrange(p7, p8, p9, nrow = 1)
```

### Angles

```{r, layout = "l-page", eval = FALSE}
### Annotations set up the color annoations to displaay the cooresponding backgrounds.
### Move up to above stats.
ang.plot <- data.table::data.table()
ang.plot$time   <- as.POSIXct(bigData$soniAmrs01_mean_avg60$timeBgn, format="%Y-%m-%d %H:%M:%OS")
ang.plot$amrs01.angX <- as.numeric(bigData$soniAmrs01_mean_avg60$angXaxsDeg)
ang.plot$amrs02.angX <- as.numeric(bigData$soniAmrs02_mean_avg60$angXaxsDeg)
ang.plot$amrs03.angX <- as.numeric(bigData$soniAmrs03_mean_avg60$angXaxsDeg)
ang.plot$amrs01.angY <- as.numeric(bigData$soniAmrs01_mean_avg60$angYaxsDeg)
ang.plot$amrs02.angY <- as.numeric(bigData$soniAmrs02_mean_avg60$angYaxsDeg)
ang.plot$amrs03.angY <- as.numeric(bigData$soniAmrs03_mean_avg60$angYaxsDeg)
ang.plot$amrs01.angZ <- as.numeric(bigData$soniAmrs01_mean_avg60$angZaxsDeg)
ang.plot$amrs02.angZ <- as.numeric(bigData$soniAmrs02_mean_avg60$angZaxsDeg)
ang.plot$amrs03.angZ <- as.numeric(bigData$soniAmrs03_mean_avg60$angZaxsDeg)
ang.plot.nona <- ang.plot %>%
  na.omit()
ang.reshape <- ang.plot.nona %>%
  reshape2::melt(id.var = "time") %>%
  dplyr::group_by(variable) %>%
  tidyr::separate(variable, into = c("sensor","stream"))
p1.ang.x <- ggplot(ang.reshape %>% dplyr::filter(stream == "angX") %>% dplyr::filter(sensor == "amrs01")) +
  annotate("rect", xmin = run_1_duration[1], xmax = run_2_duration[2], ymin = -3, ymax = 2, alpha = 0.75, fill = "black")+
  geom_point(alpha = .5, aes(x = time, y = value), color = "violet", shape = 1) +
  scale_x_datetime(date_breaks = "2 days", date_labels = "%b-%d") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  theme(axis.text.x = element_text(angle = 270), legend.position = "none") +
  labs(title = "", y = "Degrees", x = "") +
  facet_wrap(~sensor, scales = "free_y")
p2.ang.x <- ggplot(ang.reshape %>% dplyr::filter(stream == "angX") %>% dplyr::filter(sensor == "amrs02")) +
  annotate("rect", xmin = run_1_duration[1], xmax = run_1_duration[2], ymin = -3, ymax = 2, alpha = 0.75, fill = "black")+
  annotate("rect", xmin = run_2_duration[1], xmax = run_2_duration[2], ymin = -3, ymax = 2, alpha = 0.75, fill = "white")+
  geom_point(alpha = .5, aes(x = time, y = value), color = "firebrick", shape = 1) +
  scale_x_datetime(date_breaks = "2 days", date_labels = "%b-%d") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  theme(axis.text.x = element_text(angle = 270), legend.position = "none") +
  labs(title = "", y = "", x = "") +
  facet_wrap(~sensor, scales = "free_y")
p3.ang.x <- ggplot(ang.reshape %>% dplyr::filter(stream == "angX") %>% dplyr::filter(sensor == "amrs03")) +
  annotate("rect", xmin = run_1_duration[1], xmax = run_1_duration[2], ymin = -3, ymax = 2, alpha = 0.75, fill = "white")+
  annotate("rect", xmin = run_2_duration[1], xmax = run_2_duration[2], ymin = -3, ymax = 2, alpha = 0.75, fill = "black")+
  geom_point(alpha = .5, aes(x = time, y = value), color = "blue", shape = 1) +
  scale_x_datetime(date_breaks = "2 days", date_labels = "%b-%d") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  theme(axis.text.x = element_text(angle = 270), legend.position = "none") +
  labs(title = "", y = "", x = "") +
  facet_wrap(~sensor, scales = "free_y")
gridExtra::grid.arrange(p1.ang.x, p2.ang.x, p3.ang.x, nrow = 1,
                        top = grid::textGrob("Averaged (1-min) Ang X measurements",gp=gpar(fontsize=20,font=3)), 
                        bottom = grid::textGrob("Black shadding indicates general filter applied, \n\t\twhite shading indicates low-mag filter applied",gp=gpar(fontsize=12,font=3))
                          )
p1.ang.y <- ggplot(ang.reshape %>% dplyr::filter(stream == "angY") %>% dplyr::filter(sensor == "amrs01")) +
  annotate("rect", xmin = run_1_duration[1], xmax = run_2_duration[2], ymin = -3, ymax = 2, alpha = 0.75, fill = "black")+
  geom_point(alpha = .5, aes(x = time, y = value), color = "violet", shape = 1) +
  scale_x_datetime(date_breaks = "2 days", date_labels = "%b-%d") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  theme(axis.text.x = element_text(angle = 270), legend.position = "none") +
  labs(title = "", y = "Degrees", x = "") +
  facet_wrap(~sensor, scales = "free_y")
p2.ang.y <- ggplot(ang.reshape %>% dplyr::filter(stream == "angY") %>% dplyr::filter(sensor == "amrs02")) +
  annotate("rect", xmin = run_1_duration[1], xmax = run_1_duration[2], ymin = -3, ymax = 2, alpha = 0.75, fill = "black")+
  annotate("rect", xmin = run_2_duration[1], xmax = run_2_duration[2], ymin = -3, ymax = 2, alpha = 0.75, fill = "white")+
  geom_point(alpha = .5, aes(x = time, y = value), color = "firebrick", shape = 1) +
  scale_x_datetime(date_breaks = "2 days", date_labels = "%b-%d") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  theme(axis.text.x = element_text(angle = 270), legend.position = "none") +
  labs(title = "", y = "", x = "") +
  facet_wrap(~sensor, scales = "free_y")
p3.ang.y <- ggplot(ang.reshape %>% dplyr::filter(stream == "angY") %>% dplyr::filter(sensor == "amrs03")) +
  annotate("rect", xmin = run_1_duration[1], xmax = run_1_duration[2], ymin = -3, ymax = 2, alpha = 0.75, fill = "white")+
  annotate("rect", xmin = run_2_duration[1], xmax = run_2_duration[2], ymin = -3, ymax = 2, alpha = 0.75, fill = "black")+
  geom_point(alpha = .5, aes(x = time, y = value), color = "blue", shape = 1) +
  scale_x_datetime(date_breaks = "2 days", date_labels = "%b-%d") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  theme(axis.text.x = element_text(angle = 270), legend.position = "none") +
  labs(title = "", y = "", x = "") +
  facet_wrap(~sensor, scales = "free_y")
gridExtra::grid.arrange(p1.ang.y, p2.ang.y, p3.ang.y, nrow = 1,
                        top = grid::textGrob("Averaged (1-min) Ang Y measurements",gp=gpar(fontsize=20,font=3)), 
                        bottom = grid::textGrob("Black shadding indicates general filter applied, \n\t\twhite shading indicates low-mag filter applied",gp=gpar(fontsize=12,font=3))
                          )
p1.ang.z <- ggplot(ang.reshape %>% dplyr::filter(stream == "angZ") %>% dplyr::filter(sensor == "amrs01")) +
  annotate("rect", xmin = run_1_duration[1], xmax = run_2_duration[2], ymin = 330, ymax = 347, alpha = 0.75, fill = "black")+
  geom_point(alpha = .5, aes(x = time, y = value), color = "violet", shape = 1) +
  geom_hline(yintercept = 337.47, linetype = "dashed") +
  scale_x_datetime(date_breaks = "2 days", date_labels = "%b-%d") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  theme(axis.text.x = element_text(angle = 270), legend.position = "none") +
  labs(title = "", y = "Degrees", x = "") +
  ylim(330, 347) +
  facet_wrap(~sensor, scales = "free_y")
p2.ang.z <- ggplot(ang.reshape %>% dplyr::filter(stream == "angZ") %>% dplyr::filter(sensor == "amrs02")) +
  annotate("rect", xmin = run_1_duration[1], xmax = run_1_duration[2], ymin = 330, ymax = 347, alpha = 0.75, fill = "black")+
  annotate("rect", xmin = run_2_duration[1], xmax = run_2_duration[2], ymin = 330, ymax = 347, alpha = 0.75, fill = "white")+
  geom_point(alpha = .5, aes(x = time, y = value), color = "firebrick", shape = 1) +
  geom_hline(yintercept = 337.47, linetype = "dashed") +
  scale_x_datetime(date_breaks = "2 days", date_labels = "%b-%d") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  theme(axis.text.x = element_text(angle = 270), legend.position = "none") +
  ylim(330, 347) +
  labs(title = "", y = "", x = "") +
  facet_wrap(~sensor, scales = "free_y")
p3.ang.z <- ggplot(ang.reshape %>% dplyr::filter(stream == "angZ") %>% dplyr::filter(sensor == "amrs03")) +
  annotate("rect", xmin = run_1_duration[1], xmax = run_1_duration[2], ymin = 330, ymax = 347, alpha = 0.75, fill = "white")+
  annotate("rect", xmin = run_2_duration[1], xmax = run_2_duration[2], ymin = 330, ymax = 347, alpha = 0.75, fill = "black")+
  geom_point(alpha = .5, aes(x = time, y = value), color = "blue", shape = 1) +
  geom_hline(yintercept = 337.47, linetype = "dashed") +
  scale_x_datetime(date_breaks = "2 days", date_labels = "%b-%d") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  theme(axis.text.x = element_text(angle = 270), legend.position = "none") +
  ylim(330, 347) + 
  labs(title = "", y = "", x = "") +
  facet_wrap(~sensor, scales = "free_y")
gridExtra::grid.arrange(p1.ang.z, p2.ang.z, p3.ang.z, nrow = 1,
                        top = grid::textGrob("Averaged  (1-min) Ang Z measurements",gp=gpar(fontsize=20,font=3)), 
                        bottom = grid::textGrob("Black shadding indicates general filter applied, \n\t\twhite shading indicates low-mag filter applied",gp=gpar(fontsize=12,font=3))
                          )
```

### Acceleration  

```{r, layout = "l-page", eval = FALSE}
### Annotations set up the color annoations to displaay the cooresponding backgrounds.
### Move up to above stats.
acc.plot <- data.table::data.table()
acc.plot$time   <- as.POSIXct(bigData$soniAmrs01_mean_avg60$timeBgn, format="%Y-%m-%d %H:%M:%OS")
acc.plot$amrs01.accX <- as.numeric(bigData$soniAmrs01_mean_avg60$accXaxs)
acc.plot$amrs02.accX <- as.numeric(bigData$soniAmrs02_mean_avg60$accXaxs)
acc.plot$amrs03.accX <- as.numeric(bigData$soniAmrs03_mean_avg60$accXaxs)
acc.plot$amrs01.accY <- as.numeric(bigData$soniAmrs01_mean_avg60$accYaxs)
acc.plot$amrs02.accY <- as.numeric(bigData$soniAmrs02_mean_avg60$accYaxs)
acc.plot$amrs03.accY <- as.numeric(bigData$soniAmrs03_mean_avg60$accYaxs)
acc.plot$amrs01.accZ <- as.numeric(bigData$soniAmrs01_mean_avg60$accZaxs)
acc.plot$amrs02.accZ <- as.numeric(bigData$soniAmrs02_mean_avg60$accZaxs)
acc.plot$amrs03.accZ <- as.numeric(bigData$soniAmrs03_mean_avg60$accZaxs)
acc.plot.nona <- acc.plot %>%
  na.omit()
acc.reshape <- acc.plot.nona %>%
  reshape2::melt(id.var = "time") %>%
  dplyr::group_by(variable) %>%
  tidyr::separate(variable, into = c("sensor","stream"))
p1.acc.x <- ggplot(acc.reshape %>% dplyr::filter(stream == "accX") %>% dplyr::filter(sensor == "amrs01")) +
  annotate("rect", xmin = run_1_duration[1], xmax = run_2_duration[2], ymin = -0.05, ymax = 0.05, alpha = 0.75, fill = "black")+
  geom_point(alpha = .5, aes(x = time, y = value), color = "violet", shape = 1) +
  scale_x_datetime(date_breaks = "2 days", date_labels = "%b-%d") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  theme(axis.text.x = element_text(angle = 270), legend.position = "none") +
  labs(title = "", y = "Degrees", x = "") +
  facet_wrap(~sensor, scales = "free_y")
p2.acc.x <- ggplot(acc.reshape %>% dplyr::filter(stream == "accX") %>% dplyr::filter(sensor == "amrs02")) +
  annotate("rect", xmin = run_1_duration[1], xmax = run_1_duration[2], ymin = -0.05, ymax = 0.05, alpha = 0.75, fill = "black")+
  annotate("rect", xmin = run_2_duration[1], xmax = run_2_duration[2], ymin = -0.05, ymax = 0.05, alpha = 0.75, fill = "white")+
  geom_point(alpha = .5, aes(x = time, y = value), color = "firebrick", shape = 1) +
  scale_x_datetime(date_breaks = "2 days", date_labels = "%b-%d") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  theme(axis.text.x = element_text(angle = 270), legend.position = "none") +
  labs(title = "", y = "", x = "") +
  facet_wrap(~sensor, scales = "free_y")
p3.acc.x <- ggplot(acc.reshape %>% dplyr::filter(stream == "accX") %>% dplyr::filter(sensor == "amrs03")) +
  annotate("rect", xmin = run_1_duration[1], xmax = run_1_duration[2], ymin = -0.05, ymax = 0.05, alpha = 0.75, fill = "white")+
  annotate("rect", xmin = run_2_duration[1], xmax = run_2_duration[2], ymin = -0.05, ymax = 0.05, alpha = 0.75, fill = "black")+
  geom_point(alpha = .5, aes(x = time, y = value), color = "blue", shape = 1) +
  scale_x_datetime(date_breaks = "2 days", date_labels = "%b-%d") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  theme(axis.text.x = element_text(angle = 270), legend.position = "none") +
  labs(title = "", y = "", x = "") +
  facet_wrap(~sensor, scales = "free_y")
gridExtra::grid.arrange(p1.acc.x, p2.acc.x, p3.acc.x, nrow = 1,
                        top = grid::textGrob("Averaged (1-min) Acceleration X measurements",gp=gpar(fontsize=20,font=3)), 
                        bottom = grid::textGrob("Black shadding indicates general filter applied, \n\t\twhite shading indicates low-mag filter applied",gp=gpar(fontsize=12,font=3))
                          )
p1.acc.y <- ggplot(acc.reshape %>% dplyr::filter(stream == "accY") %>% dplyr::filter(sensor == "amrs01")) +
  annotate("rect", xmin = run_1_duration[1], xmax = run_2_duration[2], ymin = -0.3, ymax = -0.25, alpha = 0.75, fill = "black")+
  geom_point(alpha = .5, aes(x = time, y = value), color = "violet", shape = 1) +
  scale_x_datetime(date_breaks = "2 days", date_labels = "%b-%d") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  theme(axis.text.x = element_text(angle = 270), legend.position = "none") +
  labs(title = "", y = "Degrees", x = "") +
  facet_wrap(~sensor, scales = "free_y")
p2.acc.y <- ggplot(acc.reshape %>% dplyr::filter(stream == "accY") %>% dplyr::filter(sensor == "amrs02")) +
  annotate("rect", xmin = run_1_duration[1], xmax = run_1_duration[2], ymin = -0.3, ymax = -0.25, alpha = 0.75, fill = "black")+
  annotate("rect", xmin = run_2_duration[1], xmax = run_2_duration[2], ymin = -0.3, ymax = -0.25, alpha = 0.75, fill = "white")+
  geom_point(alpha = .5, aes(x = time, y = value), color = "firebrick", shape = 1) +
  scale_x_datetime(date_breaks = "2 days", date_labels = "%b-%d") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  theme(axis.text.x = element_text(angle = 270), legend.position = "none") +
  labs(title = "", y = "", x = "") +
  facet_wrap(~sensor, scales = "free_y")
p3.acc.y <- ggplot(acc.reshape %>% dplyr::filter(stream == "accY") %>% dplyr::filter(sensor == "amrs03")) +
  annotate("rect", xmin = run_1_duration[1], xmax = run_1_duration[2], ymin = -0.3, ymax = -0.25, alpha = 0.75, fill = "white")+
  annotate("rect", xmin = run_2_duration[1], xmax = run_2_duration[2], ymin = -0.3, ymax = -0.25, alpha = 0.75, fill = "black")+
  geom_point(alpha = .5, aes(x = time, y = value), color = "blue", shape = 1) +
  scale_x_datetime(date_breaks = "2 days", date_labels = "%b-%d") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  theme(axis.text.x = element_text(angle = 270), legend.position = "none") +
  labs(title = "", y = "", x = "") +
  facet_wrap(~sensor, scales = "free_y")
gridExtra::grid.arrange(p1.acc.y, p2.acc.y, p3.acc.y, nrow = 1,
                        top = grid::textGrob("Averaged (1-min) Acceleration Y measurements",gp=gpar(fontsize=20,font=3)), 
                        bottom = grid::textGrob("Black shadding indicates general filter applied, \n\t\twhite shading indicates low-mag filter applied",gp=gpar(fontsize=12,font=3))
                          )
p1.acc.z <- ggplot(acc.reshape %>% dplyr::filter(stream == "accZ") %>% dplyr::filter(sensor == "amrs01")) +
  annotate("rect", xmin = run_1_duration[1], xmax = run_2_duration[2], ymin = 9.7, ymax = 9.85, alpha = 0.75, fill = "black")+
  geom_point(alpha = .5, aes(x = time, y = value), color = "violet", shape = 1) +
  scale_x_datetime(date_breaks = "2 days", date_labels = "%b-%d") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  theme(axis.text.x = element_text(angle = 270), legend.position = "none") +
  labs(title = "", y = "Degrees", x = "") +
  facet_wrap(~sensor, scales = "free_y")
p2.acc.z <- ggplot(acc.reshape %>% dplyr::filter(stream == "accZ") %>% dplyr::filter(sensor == "amrs02")) +
  annotate("rect", xmin = run_1_duration[1], xmax = run_1_duration[2], ymin = 9.7, ymax = 9.85, alpha = 0.75, fill = "black")+
  annotate("rect", xmin = run_2_duration[1], xmax = run_2_duration[2], ymin = 9.7, ymax = 9.85, alpha = 0.75, fill = "white")+
  geom_point(alpha = .5, aes(x = time, y = value), color = "firebrick", shape = 1) +
  scale_x_datetime(date_breaks = "2 days", date_labels = "%b-%d") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  theme(axis.text.x = element_text(angle = 270), legend.position = "none") +
  labs(title = "", y = "", x = "") +
  facet_wrap(~sensor, scales = "free_y")
p3.acc.z <- ggplot(acc.reshape %>% dplyr::filter(stream == "accZ") %>% dplyr::filter(sensor == "amrs03")) +
  annotate("rect", xmin = run_1_duration[1], xmax = run_1_duration[2], ymin = 9.7, ymax = 9.85, alpha = 0.75, fill = "white")+
  annotate("rect", xmin = run_2_duration[1], xmax = run_2_duration[2], ymin = 9.7, ymax = 9.85, alpha = 0.75, fill = "black")+
  geom_point(alpha = .5, aes(x = time, y = value), color = "blue", shape = 1) +
  scale_x_datetime(date_breaks = "2 days", date_labels = "%b-%d") +
  scale_y_continuous(breaks = scales::pretty_breaks(n = 6))+
  theme(axis.text.x = element_text(angle = 270), legend.position = "none") +
  labs(title = "", y = "", x = "") +
  facet_wrap(~sensor, scales = "free_y")
gridExtra::grid.arrange(p1.acc.z, p2.acc.z, p3.acc.z, nrow = 1,
                        top = grid::textGrob("Averaged  (1-min) Acceleration Z measurements",gp=gpar(fontsize=20,font=3)), 
                        bottom = grid::textGrob("Black shadding indicates general filter applied, \n\t\twhite shading indicates low-mag filter applied",gp=gpar(fontsize=12,font=3))
                          )
```

```{r, layout = "l-page", eval = FALSE}
#Ploting 1:1 comparison each soniAmrs
require(stats)
# Westerly wind will give us better data
dirOut <- "N:/Science/FIUData/kstyers/amrs.cmpr/"
data.plot <- data.table()
data.plot$soniAmrs01_mean_avg60.angXaxs = bigData$soniAmrs01_mean_avg60$angXaxs
data.plot$soniAmrs02_mean_avg60.angXaxs = bigData$soniAmrs02_mean_avg60$angXaxs
data.plot$soniAmrs03_mean_avg60.angXaxs = bigData$soniAmrs03_mean_avg60$angXaxs
data.plot$soniAmrs01_mean_avg60.angYaxs = bigData$soniAmrs01_mean_avg60$angYaxs
data.plot$soniAmrs02_mean_avg60.angYaxs = bigData$soniAmrs02_mean_avg60$angYaxs
data.plot$soniAmrs03_mean_avg60.angYaxs = bigData$soniAmrs03_mean_avg60$angYaxs
data.plot$soniAmrs01_mean_avg60.angZaxs = bigData$soniAmrs01_mean_avg60$angZaxs
data.plot$soniAmrs02_mean_avg60.angZaxs = bigData$soniAmrs02_mean_avg60$angZaxs
data.plot$soniAmrs03_mean_avg60.angZaxs = bigData$soniAmrs03_mean_avg60$angZaxs
data.plot <- data.plot %>%
  dplyr::filter(is.na(soniAmrs01_mean_avg60.angXaxs) == FALSE) %>%
  dplyr::filter(is.na(soniAmrs02_mean_avg60.angXaxs) == FALSE) %>%
  dplyr::filter(is.na(soniAmrs03_mean_avg60.angXaxs) == FALSE) %>%
  dplyr::filter(is.na(soniAmrs01_mean_avg60.angYaxs) == FALSE) %>%
  dplyr::filter(is.na(soniAmrs02_mean_avg60.angYaxs) == FALSE) %>%
  dplyr::filter(is.na(soniAmrs03_mean_avg60.angYaxs) == FALSE) %>%
  dplyr::filter(is.na(soniAmrs01_mean_avg60.angZaxs) == FALSE) %>%
  dplyr::filter(is.na(soniAmrs02_mean_avg60.angZaxs) == FALSE) %>%
  dplyr::filter(is.na(soniAmrs03_mean_avg60.angZaxs) == FALSE)
p1 <- ggplot(data = data.plot, aes(x = soniAmrs01_mean_avg60.angXaxs, y = soniAmrs02_mean_avg60.angXaxs)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red") +
  labs(title = "soniAmrs 1 and 2", subtitle = "\tangXaxs", x = "soniAmrs01 angXaxs", y = "soniAmrs02 angXaxs")
p2 <- ggplot(data = data.plot, aes(x = soniAmrs01_mean_avg60.angXaxs, y = soniAmrs03_mean_avg60.angXaxs)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red")+
  labs(title = "soniAmrs 1 and 3", subtitle = "\tangXaxs",x = "soniAmrs01 angXaxs", y = "soniAmrs03 angXaxs")
p3 <- ggplot(data = data.plot, aes(x = soniAmrs02_mean_avg60.angXaxs, y = soniAmrs03_mean_avg60.angXaxs)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red")+
  labs(title = "soniAmrs 2 and 3", subtitle = "\tangXaxs",x = "soniAmrs02 angXaxs", y = "soniAmrs03 angXaxs")
  
gridExtra::grid.arrange(p1, p2, p3, nrow = 1)
p4 <- ggplot(data = data.plot, aes(x = soniAmrs01_mean_avg60.angYaxs, y = soniAmrs02_mean_avg60.angYaxs)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red") +
  labs(title = "soniAmrs 1 and 2", subtitle = "\tangYaxs", x = "soniAmrs01 angYaxs", y = "soniAmrs02 angYaxs")
p5 <- ggplot(data = data.plot, aes(x = soniAmrs01_mean_avg60.angYaxs, y = soniAmrs03_mean_avg60.angYaxs)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red")+
  labs(title = "soniAmrs 1 and 3", subtitle = "\tangYaxs",x = "soniAmrs01 angYaxs", y = "soniAmrs03 angYaxs")
p6 <- ggplot(data = data.plot, aes(x = soniAmrs02_mean_avg60.angYaxs, y = soniAmrs03_mean_avg60.angYaxs)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red")+
  labs(title = "soniAmrs 2 and 3", subtitle = "\tangYaxs",x = "soniAmrs02 angYaxs", y = "soniAmrs03 angYaxs")
  
gridExtra::grid.arrange(p4, p5, p6, nrow = 1)
p7 <- ggplot(data = data.plot, aes(x = soniAmrs01_mean_avg60.angZaxs, y = soniAmrs02_mean_avg60.angZaxs)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red") +
  labs(title = "soniAmrs 1 and 2", subtitle = "\tangZaxs", x = "soniAmrs01 angZaxs", y = "soniAmrs02 angZaxs")
p8 <- ggplot(data = data.plot, aes(x = soniAmrs01_mean_avg60.angZaxs, y = soniAmrs03_mean_avg60.angZaxs)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red")+
  labs(title = "soniAmrs 1 and 3", subtitle = "\tangZaxs",x = "soniAmrs01 angZaxs", y = "soniAmrs03 angZaxs")
p9 <- ggplot(data = data.plot, aes(x = soniAmrs02_mean_avg60.angZaxs, y = soniAmrs03_mean_avg60.angZaxs)) +
  geom_point() + 
  geom_smooth(method = "lm", color = "red")+
  labs(title = "soniAmrs 2 and 3", subtitle = "\tangZaxs",x = "soniAmrs02 angZaxs", y = "soniAmrs03 angZaxs")
  
gridExtra::grid.arrange(p7, p8, p9, nrow = 1)
```